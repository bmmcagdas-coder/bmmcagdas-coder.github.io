<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duyuru KaydÄ±</title>
    <!-- OneSignal v15 SDK (KÃ¶prÃ¼ sayfalarÄ± iÃ§in en stabildir) -->
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
    <script>
        window.OneSignal = window.OneSignal || [];
        const urlParams = new URLSearchParams(window.location.search);
        const uid = urlParams.get('uid');
        const appId = urlParams.get('appid');
        const role = urlParams.get('role');

        OneSignal.push(function() {
            // Ã–nceki hatalÄ± kayÄ±tlarÄ± temizle (Reset)
            OneSignal.SERVICE_WORKER_PARAM = { scope: '/' };
            
            OneSignal.init({
                appId: appId,
                allowLocalhostAsSecureOrigin: true,
            });

            // KullanÄ±cÄ± eÅŸleÅŸtirme (v15 mantÄ±ÄŸÄ±)
            if (uid) {
                OneSignal.setExternalUserId(uid);
                if (role) {
                    OneSignal.sendTag("user_role", role);
                }
            }

            // Sayfa aÃ§Ä±lÄ±r aÃ§Ä±lmaz kutuyu zorla (requestPermission)
            OneSignal.showSlidedownPrompt();
        });

        // Ä°zin verildiÄŸinde sayfayÄ± kapat
        OneSignal.on('subscriptionChange', function (isSubscribed) {
            if (isSubscribed) {
                document.getElementById('status-text').innerHTML = "<b style='color:green;'>KayÄ±t BaÅŸarÄ±lÄ±!</b><br>Pencere kapatÄ±lÄ±yor...";
                setTimeout(() => { window.close(); }, 3000);
            }
        });
    </script>
</head>
<body style="text-align:center; font-family:sans-serif; padding-top:50px; background-color:#f4f4f4;">
    <div style="background:white; padding:30px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.1); display:inline-block; width:90%; max-width:400px;">
        <h2>ðŸ”” Duyuru KaydÄ±</h2>
        <p id="status-text">LÃ¼tfen yukarÄ±da Ã§Ä±kan kutucukta <b>"Ä°zin Ver"</b> butonuna basÄ±n.</p>
        <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
        <button onclick="OneSignal.showNativePrompt()" style="padding:12px; background:#007bff; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold; width:100%;">
            KUTUCUK GELMEZSE BURAYA TIKLAYIN
        </button>
    </div>
</body>
</html>
