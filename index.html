<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duyuru KaydÄ± - Debug Mode</title>
    <!-- OneSignal v16 SDK -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignal = window.OneSignal || [];
      
      const urlParams = new URLSearchParams(window.location.search);
      const uid = urlParams.get('uid');
      const appId = urlParams.get('appid');

      async function startOneSignal() {
        try {
            await OneSignal.init({
                appId: appId,
                allowLocalhostAsSecureOrigin: true,
            });

            if (uid) {
                await OneSignal.login(uid);
                document.getElementById('debug-log').innerHTML += "â€¢ KullanÄ±cÄ± giriÅŸi yapÄ±ldÄ±: " + uid + "<br>";
            }

            // DURUM KONTROLÃœ
            const isPushSupported = OneSignal.Notifications.isPushSupported();
            document.getElementById('debug-log').innerHTML += "â€¢ Bildirim desteÄŸi: " + (isPushSupported ? "VAR" : "YOK") + "<br>";

            // Ä°zin isteme komutu
            showPermissionPrompt();

        } catch (err) {
            document.getElementById('debug-log').innerHTML += "<b style='color:red;'>â€¢ HATA: " + err + "</b><br>";
        }
      }

      async function showPermissionPrompt() {
          document.getElementById('debug-log').innerHTML += "â€¢ Ä°zin kutusu tetikleniyor...<br>";
          await OneSignal.Notifications.requestPermission();
      }

      OneSignal.push(startOneSignal);

      OneSignal.Notifications.addEventListener("permissionChange", (permission) => {
        if (permission) {
            document.getElementById('status-text').innerHTML = "<b style='color:green;'>Ä°ÅžLEM BAÅžARILI!</b><br>KayÄ±t yapÄ±ldÄ±.";
            setTimeout(() => { window.close(); }, 3000);
        }
      });
    </script>
</head>
<body style="text-align:center; font-family:sans-serif; padding:20px; background-color:#f4f4f4; color: #333;">
    <div style="background:white; padding:30px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.1); display:inline-block; width:100%; max-width:450px; box-sizing:border-box;">
        <h2 style="color:#eb4d4b; margin-top:0;">ðŸ”” Duyuru KaydÄ±</h2>
        <p id="status-text">LÃ¼tfen yukarÄ±da Ã§Ä±kan kutucukta <b>"Ä°zin Ver"</b> deyin.</p>
        
        <!-- MANUEL BUTON: TarayÄ±cÄ± engellerse buna basÄ±lacak -->
        <button onclick="showPermissionPrompt()" style="background:#007bff; color:white; border:none; padding:12px 20px; border-radius:8px; font-weight:bold; cursor:pointer; width:100%; margin:10px 0;">
            KUTUCUK Ã‡IKMAZSA BURAYA TIKLAYIN
        </button>

        <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
        
        <!-- HATA AYIKLAMA PANELÄ° -->
        <div id="debug-log" style="text-align:left; font-size:12px; background:#eee; padding:10px; border-radius:5px; font-family:monospace; color:#444;">
            <b>Sistem KayÄ±tlarÄ±:</b><br>
        </div>
    </div>
</body>
</html>
