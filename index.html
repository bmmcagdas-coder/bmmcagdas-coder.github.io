<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bildirim KaydÄ± - Staj Takip Sistemi</title>
    
    <!-- Webpushr SDK -->
    <script>
    (function (w, d, s, id) {
        if (typeof (w.webpushr) !== 'undefined') return;
        w.webpushr = w.webpushr || function () { (w.webpushr.q = w.webpushr.q || []).push(arguments); };
        var js, fjs = d.getElementsByTagName(s)[0];
        js = d.createElement(s); js.id = id; js.async = 1;
        js.src = "https://cdn.webpushr.com/app.min.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(window, document, 'script', 'webpushr-jssdk'));

    webpushr('setup', { 
        'key': 'BCAqoBi7PifomzI8rpkbs2lxqKu1LrWNJCfOf22kC8BPbejb-_XKTe9ZK9SgOLt54U9RDZ4cX7-XzP5dr3ckVWc' 
    });

    // --- KRÄ°TÄ°K KISIM: KULLANICIYI ETÄ°KETLEME ---
    // URL'den kullanÄ±cÄ± adÄ±nÄ± al (Ã–rn: ?uid=uzay)
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('uid');

    if (userId) {
        // Webpushr sistemine bu cihazÄ±n kime ait olduÄŸunu bildiriyoruz
        webpushr('attributes', { "user_id": userId });
        console.log("Cihaz ÅŸu kullanÄ±cÄ±ya baÄŸlandÄ±: " + userId);
    }

    // KullanÄ±cÄ± "Ä°zin Ver" dediÄŸinde ne olacaÄŸÄ±nÄ± belirleyelim
    webpushr('onNotificationPromptAction', function(action) {
        if (action === 'allow') {
            document.getElementById('status-text').innerHTML = "<b style='color:green;'>Ä°ÅŸlem BaÅŸarÄ±lÄ±!</b><br>KaydÄ±nÄ±z tamamlandÄ±. Bu pencereyi kapatÄ±p uygulamaya dÃ¶nebilirsiniz.";
            // 3 saniye sonra pencereyi otomatik kapatmayÄ± dene (her tarayÄ±cÄ± izin vermeyebilir)
            setTimeout(() => { window.close(); }, 3000);
        }
    });
    </script>
</head>
<body style="text-align:center; font-family:sans-serif; padding-top:50px; background-color:#f4f4f4; color: #333;">
    <div style="background:white; padding:30px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.1); display:inline-block; max-width:90%; width: 400px;">
        <h2 style="margin-top:0; color:#2ecc71;">ğŸ”” Duyuru KaydÄ±</h2>
        <p id="status-text">Bildirimleri aktif etmek iÃ§in lÃ¼tfen aÅŸaÄŸÄ±daki butona basÄ±n ve Ã§Ä±kan kutucukta <b>"Ä°zin Ver"</b> deyin.</p>
        
        <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">

        <!-- Webpushr Abonelik Butonu -->
        <div id="webpushr-subscription-button" 
             data-button-text="BÄ°LDÄ°RÄ°MLERÄ° AKTÄ°F ET" 
             data-subscriber-count-text="KullanÄ±cÄ± KayÄ±tlÄ±." 
             data-background-color="#2ecc71" 
             data-color="#ffffff">
        </div>

        <p style="margin-top:20px; font-size:12px; color:#999;">
            Zaten abonesiniz butonu gÃ¶rmeyebilirsiniz.<br>
            Bu iÅŸlem cihaz bazlÄ±dÄ±r (Android ve Windows iÃ§in ayrÄ± ayrÄ± yapÄ±lmalÄ±dÄ±r).
        </p>
    </div>
</body>
</html>
